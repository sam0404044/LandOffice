<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>LIFF æ¸¬è©¦è¡¨å–®</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
  <h2>LIFF æ¸¬è©¦è¡¨å–®</h2>
  <p>æŒ‰ä¸‹æŒ‰éˆ•å¾Œï¼ŒæœƒæŠŠä½ çš„ LINE userId å‚³åˆ° GASï¼Œä¸¦æ¨æ’­ã€Œé ç´„å®Œæˆã€è¨Šæ¯ã€‚</p>

  <form id="testForm">
    <label>å§“åï¼š
      <input id="name" name="name" required>
    </label>
    <br><br>
    <button type="submit">é€å‡ºæ¸¬è©¦</button>
  </form>

  <div id="status"></div>

  <script>
    const GAS_ENDPOINT = "ğŸ‘‰ é€™è£¡æ›æˆä½ çš„ GAS Web App /exec URL";
    const LIFF_ID = "ğŸ‘‰ é€™è£¡æ›æˆä½ çš„ LIFF_ID (ä¾‹å¦‚ 2008032262-oybPJNJN)";

    async function initLiff() {
      await liff.init({ liffId: LIFF_ID });
      if (!liff.isLoggedIn()) {
        liff.login();
      }
    }
    initLiff();

    document.getElementById("testForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      document.getElementById("status").textContent = "é€å‡ºä¸­â€¦";

      try {
        // æŠ“ LINE userId
        const profile = await liff.getProfile();
        const userId = profile.userId;

        // çµ„é€å‡ºçš„è³‡æ–™
        const payload = new URLSearchParams();
        payload.set("key", "form1"); // å…ˆç”¨ form1 åšæ¸¬è©¦
        payload.set("name", document.getElementById("name").value);
        payload.set("lineUserId", userId);

        const res = await fetch(GAS_ENDPOINT, {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: payload.toString(),
        });

        if (res.ok) {
          document.getElementById("status").textContent = "âœ… å·²é€å‡ºï¼Œè«‹åˆ° LINE æŸ¥çœ‹æ˜¯å¦æ”¶åˆ°æ¨æ’­è¨Šæ¯";
        } else {
          document.getElementById("status").textContent = "âŒ é€å‡ºå¤±æ•—ï¼š" + res.status;
        }
      } catch (err) {
        document.getElementById("status").textContent = "éŒ¯èª¤ï¼š" + err;
        console.error(err);
      }
    });
  </script>
</body>
</html>
